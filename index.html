<!DOCTYPE html>
<html>

<head>
    <title>tic-tac-toe</title>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <style type="text/css">
    td {
        width: 120px;
        height: 120px;
       /* border: thin solid white*/
        background-color:black;
        color:white;
        cursor: pointer;
        text-align: center;
        vertical-align: middle;
        

    }

    .x::before {
        content: "X";
    }

    .o::before {
        content: "O";
    }
    
    </style>
</head>

<body>
    <h1>Tic Tac Toe</h1>
    <button onclick="startNewGame('playground', 3, 3)">Start new game</button>
    <div id="playground">
    </div>
    <p id="result"></p>
    <script type="text/javascript">
    function startNewGame(parentId, numOfRows, numOfColumns) {
        // initialize moves array
        let moves = [];
        let gameEnded = false;
        $('#result').text("Your move! ");
        // empty parent
        $('#' + parentId).empty();
        // create table
        const table = $('<table>').appendTo($('#' + parentId));
        for (let ri = 0; ri < numOfRows; ri++) {
            const tr = $('<tr>').appendTo(table);
            for (let ci = 0; ci < numOfColumns; ci++) {
                const td = $('<td>').appendTo(tr);
                td.click(function() {
                    if (moves.length == 9 || gameEnded) {
                        return;
                    }
                    //debugger;
                    const position = $('td').index($(this));
                    if (moves.indexOf(position) == -1) {
                        moves.push(position);
                        const isXMove = moves.length % 2 == 1;
                        $(this).attr("class", isXMove ? "x" : "o");
                        if (moves.length >= 5) {
                            const movesToCheck = moves.filter(function(element, index, array) {
                                return isXMove ? index % 2 == 0 : index % 2 == 1;
                            });
                            const movesToCheckString = movesToCheck.sort().join('');
                            const paths = ["012", "345", "678", "036", "147", "258", "048", "246"];
                            for (let i = 0; i < paths.length; i++) {
                                const path = paths[i];
                                if (movesToCheckString.indexOf(path[0]) != -1 && movesToCheckString.indexOf(path[1]) != -1
                                   && movesToCheckString.indexOf(path[2]) != -1) {
                                    gameEnded = true;
                                    $('#result').text("GAME OVER");
                                    break;
                                }if (moves.length == 9){
                                    $('#result').text(" GAME DRAW");
                                }
                            }
                        }
                        if (!gameEnded && isXMove) {
                            const tds = $("td").not(".x").not(".o");
                            if (tds && tds.length > 0) {
                                const td = tds[0]
                                td.click();
                            }
                        }
                    }
                });
            }
        }
    }
    </script>
</body>

</html>